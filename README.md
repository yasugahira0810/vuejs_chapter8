# CHAPTER8 Vuexでアプリケーションの状態を管理する

## *はじめに*

### *注意事項*

- *このリポジトリは[[秋葉原] 基礎から学ぶVue.js 輪読会(Vuex + VueRouter)](https://weeyble-js.connpass.com/event/100388/)の発表資料として用意したリポジトリです。*
- *書籍の要約は正体、担当者の理解で書いているところは斜体で記載しています。*
- *「サンプルあり」と記載のある箇所は、サンプルを動かしながら説明します。*
- *権利関係で問題があれば、対応するのでご指摘ください。*

### *8章の構成*

*3章は13節, 14節, 15節の3節構成で、メインは14節。中身はザクっと以下の通り。*  

- *13. イベントハンドリング => DOMイベントを受け取って処理する方法を学ぶ。本節の学習内容は14節のインプットとなる。*
- *14. フォーム入力バインディング => Vue.jsの双方向データバインディングを説明する節。*
  + *双方向データバインティング = データバインディング(2章7節, 8節で説明) + イベントハンドリング(3章13節で説明)*
- *15. マウント要素外のイベントと操作 => 前節までの説明が当てはまらないケースの説明。*

-------------------

## SECTION41 Vuexとは

- Vuexとは、データとその状態(state)を管理する**状態管理のための拡張ライブラリ**。
- CHAPTER5「コンポーネントでUI部品を作る」でコンポーネント間のデータのやり取りの仕方を学んだ。シンプルなアプリケーションはCHAPTER5の内容で十分だが、コンポーネントを構造化したりアプリケーションの規模が大きくなると管理が難しくなってくる。
- Vuexを導入することで、面倒なデータ管理から解放される。加えて、整合性も保ちやすくなる。
- 

### Vuexを導入するメリット

- CHAPTER5の内容は特定のコンポーネント間の局所的なデータのやり取りだった。
- 対してVuexは特定のコンポーネント間だけでなく、アプリケーション全体でデータを共有する。
- P.154の図とP.253の図を見比べるとイメージしやすい。（*⌘＋Gで157、その後⌘＋Gで252*）

### Vuexのインストール

- 省略

### *補足*

- *本章を読み進める上で、[Vuex入門](https://vuex.vuejs.org/ja/guide/)の冒頭も参考になるので引用する*


*Vuex アプリケーションの中心にあるものはストアです。"ストア" は、基本的にアプリケーションの 状態（state） を保持するコンテナです。単純なグローバルオブジェクトとの違いが 2つあります。*

*1. Vuex ストアはリアクティブです。Vue コンポーネントがストアから状態を取り出すとき、もしストアの状態が変化したら、ストアはリアクティブかつ効率的に更新を行います。*

*2. ストアの状態を直接変更することはできません。明示的にミューテーションをコミットすることによってのみ、ストアの状態を変更します。これによって、全ての状態の変更について追跡可能な記録を残すことが保証され、ツールでのアプリケーションの動作の理解を助けます。*

- *以降の節ではずっとストアの話が続くが、少なくとも本節を読む上ではVuexとほぼ同じものと捉えてよさそう。*
- *グローバルオブジェクトとの違いの2点目は、Fluxアーキテクチャのことを示しているっぽい。（よくわかっていない）*

-------------------

## SECTION42 シンプルなストア構造

- [コード](https://github.com/yasugahira0810/VueChapter8App/tree/0b769237ae1ca685074b915875cfc21f2e31bbf2)
- *コードの中身は次節で説明するので省略。画面は無しで、コンソールログに0と1が出力されるはず。*

### ストアをVueアプリケーションに登録する

- 省略。

### Vuex内のインスタンスの参照方法

- Vue.js本体はthisを使う。*P.60参照。メソッド内ではプロパティ名にthisをつける必要があって、このthisはインスタンスを指すという話があった。*
- それに対してVuexのインスタンスはthisは使わず、プロパティやメソッドは引数として渡す。そのためメソッド定義にもアロー関数を使用できる。

-------------------

## SECTION43 コアコンセプト

### 補足

- *P.258の図を理解することが本節で一番重要な気がする。*
- *WEB+DB PRESS Vol106の「仮想DOM革命」という記事に仮想DOMやFluxアーキテクチャのことが書いてあっ他ので、（難しくて理解が曖昧だが）その内容を踏まえて補足する。*
- *P.258の図に、公式ドキュメントとWEB+DB PRESSの記事を併せて、自分なりの理解として図示したのが下の図。*

![Vuexアーキテクチャ](./vuex_architecture.png)

- *この図で大事なのはComponentがStateを更新したい場合、直接Stateを更新することはできず、間にあるActionsとMutationsを介さないといけないということっぽい。*
- *StateとComponentを双方向に通信させず、ComponentがStateを更新する場合はActionsとMutationsを介すアーキテクチャを取ることで、状態管理が複雑になる問題を解消しているらしい。*
- *Fluxというアーキテクチャが登場するまでは、サーバサイドMVCをクライアント側に適用したクライアントサイドMVCというアーキテクチャが使われていたが、この状態管理の複雑さが深刻な問題だったっぽい。*
- *図のようなアーキテクチャを単方向データフローというらしい。*

### ステート（state）

- ストアで管理している状態そのもの。
- コンポーネントでいうところのdata。

### ゲッター（getter）

- stateを取得するための算出データ。
- コンポーネントでいうところのcomputed(算出プロパティ)とmethodsの中間のような機能。
- 算出プロパティとの違い
  + 引数を渡せる
  + セッター機能なし
  + 定義するメソッドの引数として使用できるプロパティやメソッドが受け取れる
- getterを介さず直接stateにアクセスすることもできるが、混乱を避けるため常にゲッターを介すのがおすすめ。（*やろうとすれば直接stateにアクセスできちゃうの？？？*）

### ミューテーション（mutations）

- ステートを変更できる唯一のメソッド。
- コンポーネントでいうところのmethods。
- ミューテーションおよびアクションのメソッドは「タイプ」と呼ばれる。

#### コミット

- ミューテーションを明示的に呼び出すための特別なメソッド。
- 登録されているミューテーションを呼び出すインスタンスメソッド。
- コンポーネントでいうところの$emitに似ている。

### アクション（actions）

- 非同期処理を含めることのできるメソッド。
- データの加工や非同期処理を行い、その結果をミューテーションへコミットする。

#### ディスパッチ（dispatch）

- アクションを明示的に呼び出すための特別なメソッド。
- 登録されているアクションを呼び出すインスタンスメソッド。
- 別のアクション内からも使用できる。
- 非同期処理がなければアクションを介さず、直接コミットすることもできるが、混乱を避けるためすべてdispatchに統一するのがおすすめ。

### Vuexのルール

- Vuexが提供するルールに従って状態管理の定義と更新をすることで、保守性を向上できる。
  + アプリケーションレベルの状態はストアで管理する
  + 状態を変更できるのはミューテーション内のみ
  + 非同期処理はコミットする前に済ませておく

-------------------

## SECTION44 コンポーネントでストアを使用しよう

-------------------

## SECTION45 モジュールで大きくなったストアを分割する

### モジュールの使い方

### 同一のミューテーションタイプ

### ネームスペース

### モジュールのネスト

### ネームスペース付きモジュールから外部へのアクセス

### モジュールをファイルごとに

### モジュールの再利用

-------------------

## SECTION46 その他のストアやオプション

### ストアの状態を監視する

### Strictモードで開発する

### Vuexでホットリロードを使用する

# 用語集

|用語|略称|説明|該当ページ|
|---|---|---|---|
|テンプレート|-|DOMを構築する手段|P.26|
|ディレクティブ|-|テンプレートとロジックを関連付ける方法。Vue.jsのテンプレートでは「v-」で始まる。主にデータバインディングを行うために使用される。ディレクティブの値はJavaScriptの単一な式。|P.26, P.28|
|マウント|-|DOM要素とアプリケーションを紐づけること。DOMを構築する手段。マウントする要素はelセレクタで指定する。|P.27, P.44|
|データバインディング|-|データと描画を同期させる仕組み。JavaScriptのデータとそれを使用する場所を紐付け、データに変化があれば自動的にDOMを更新する。DOMの更新を自動化する。リアクティブシステムで実現される機能のうちの１つ。データのタイプやバインドする場所によって、書き方や更新の仕方に少し違いがある。|P.27, P.28, P.52|
|双方向データバインディング|-|フォームの入力値及び選択値をデータと同期させる。v-modelディレクティブを使う。|P.105|
|コンポーネント|-|機能ごとにJavaScriptとテンプレートを1つのセットにして、他の機能とは分離して開発できるようにする仕組み。コンポーネントが複雑に構造化された場合は「Vuex」や「Vue Router」といった拡張機能を導入することで目的に応じたスケールアップも可能。１つのアプリの中に１つだけnew Vue()して、そこにコンポーネントとしてUI部品を追加していく。|P.29, P.31, P.50|
|リアクティブデータ|-|Vue.jsによって取得したとき（get）と代入したとき（set）のフック処理が登録された、反応のできるデータのこと。|P.52|
|リアクティブシステム|-|Vue.jsの心臓。DOMの更新, DOMの更新の最適化, 加工データの同期, 変更検知による処理実行などができる。Vue.jsのほとんどの機能を担う。|P.52|
|マスタッシュ|-|{{ message }}みたいな記法のこと。マスタッシュ内には{{ 1 + 1 }}のような式を書ける。{{ var foo = message }}のような文は使用できない。イコールの右にかけるものが式。||P.54, P.56|
|ライフサイクルフック|-|特定のタイミングで自動的に処理を挟む|P.84|
|イベントハンドリング|-|	ボタンクリックといったDOMイベントを受け取って処理を行うこと。JavaScriptだとaddEventListenerメソッド, jQueryだと$(element).onメソッドが使用される。Vue.jsではテンプレートの中でv-onディレクトリを使用する。|P.96|
|イベントハンドラ|ハンドラ|イベントに紐付ける処理の内容|P.96|
|ハンドル|-|イベントハンドラとイベントを紐付けること|P.96|
|バブリング|-|ターゲットを包含している要素のイベントが連鎖して親要素方向に向かって行われること|P.100|
|単一ファイルコンポーネント|SFC|コンポーネントの定義方法の１つ。HTML, JavaScript, CSSを「.vue」という拡張子のファイルにまとめて管理する。|P.221|
|Vuex|-|データとその状態に関するすべてを一元管理する状態管理のための拡張ライブラリ|P.252|
|ストア|-|Vuexが状態管理するために作成するのがストア。アプリケーション内に作った仮想データベースのようなもの。stateオプションにアプリケーションで使用するデータを定義する。|P.255|
|ステート|-|ストアで管理している状態（データ）そのもの。コンポーネントでいうところのdata。|P.259|
|ミューテーション|-|ステートを変更できる唯一のメソッド。コンポーネントでいうところのmethods。|P.259|
|ゲッター|-|ステートを取得するための算出データ。コンポーネントでいうところのcomputed, methodsの中間のような機能。ゲッターを介さず直接ステートにアクセスすることもできるが、混乱を避けるため常にゲッターを介すのも著者的にはおすすめ。|P.260|
|コミット|-|登録されているミューテーションを呼び出すインスタンスメソッド。コンポーネントでいうところの$emitと似ている。|P.261|
|アクション|-|非同期処理を含めることのできるメソッド。データの加工や非同期処理を行い、その結果をミューテーションへコミットする。|P.262|
|ディスパッチ|-|登録されているアクションを呼び出すインスタンスメソッド。別のアクション内からも使用できる。非同期処理がなければアクションを介さず、直接コミットすることもできるが、混乱を避けるためすべてdispatchに統一するのが著者的におすすめ。|P.263|